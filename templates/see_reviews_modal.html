<div
  class="modal fade bd-example-modal-lg"
  tabindex="-1"
  role="dialog"
  id="seeReviewsModal"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Reviews</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <style>
        .modal-backdrop {
          opacity: 0.25 !important;
        }

        /* Room reviews styling */
        .review-item {
          background-color: #f8f9fa;
          border-radius: 8px;
          padding: 15px;
          margin-bottom: 20px;
        }
        
        .review-item h5 {
          color: #6c757d;
          font-size: 14px;
          margin-bottom: 10px;
        }
        
        .review-item h6 {
          font-weight: bold;
          margin-bottom: 10px;
        }
        
        .review-item p {
          font-size: 16px;
          line-height: 1.5;
        }
        
        /* Star Rating System for Modal */
        #seeReviewsModal .star-rating {
          display: flex !important;
          flex-direction: row-reverse !important;
          justify-content: center !important;
          margin: 20px 0 !important;
        }
        
        #seeReviewsModal .star-rating input {
          display: none !important;
        }
        
        #seeReviewsModal .star-rating label {
          cursor: pointer !important;
          width: 30px !important;
          height: 30px !important;
          margin: 0 5px !important;
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23e5e5e5'%3E%3Cpath d='M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z'/%3E%3C/svg%3E") !important;
          background-repeat: no-repeat !important;
          background-position: center !important;
          background-size: 30px !important;
        }
        
        #seeReviewsModal .star-rating input:checked ~ label {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23f5c842'%3E%3Cpath d='M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z'/%3E%3C/svg%3E") !important;
        }
        
        #seeReviewsModal .star-rating label:hover,
        #seeReviewsModal .star-rating label:hover ~ label {
          background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23f5c842'%3E%3Cpath d='M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z'/%3E%3C/svg%3E") !important;
        }
        
        /* Modal form styling */
        #seeReviewsModal .room-info {
          text-align: center;
          margin-bottom: 20px;
          font-size: 16px;
          color: #333;
        }
        
        #seeReviewsModal .character-counter {
          text-align: right;
          margin-top: 5px;
          color: #6c757d;
          font-size: 14px;
        }
        
        #seeReviewsModal .form-group {
          margin-bottom: 20px;
        }
        
        #seeReviewsModal .submit-button {
          background-color: #4e73df;
          color: white;
          border: none;
          border-radius: 4px;
          padding: 8px 20px;
          cursor: pointer;
          transition: all 0.2s;
          font-size: 14px;
        }
        
        #seeReviewsModal .submit-button:hover {
          background-color: #3a5fc9;
        }
        
        #seeReviewsModal .coming-soon {
          display: inline-block;
          background-color: #f8f9fa;
          color: #6c757d;
          padding: 10px 20px;
          border-radius: 4px;
          border: 1px dashed #adb5bd;
          font-style: italic;
          margin: 10px 0;
          font-size: 14px;
        }
        
        #seeReviewsModal h2 {
          font-size: 18px;
          margin: 15px 0;
          font-weight: 500;
          text-align: center;
        }
        
        #seeReviewsModal textarea {
          resize: none;
          height: 120px;
        }
        
        #seeReviewsModal .form-check {
          margin: 15px 0;
        }
        
        /* Hide the old star styling */
        .star {
          display: none !important;
        }
      </style>
      <link
        rel="stylesheet"
        href="{{ url_for('static', filename='assets/css/main.css') }}"
      />
      <link
        rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
        crossorigin="anonymous"
      />
      <link
        rel="stylesheet"
        href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css"
      />
      <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css"
      />
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      />
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"
      ></script>
      <script
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"
      ></script>
      <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
      <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
      <!-- Add Notyf for notifications -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
      <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
      <div class="modal-body" id="reviews-body">
        <!-- The review content will be loaded here dynamically -->
      </div>
    </div>
  </div>
</div>

<script>
  // Initialize Notyf for notifications without redeclaring
  if (typeof window.notyf === 'undefined') {
    window.notyf = new Notyf({
      duration: 5000,
      position: {
        x: 'right',
        y: 'top',
      },
      types: [
        {
          type: 'success',
          backgroundColor: '#4e73df',
          icon: false
        },
        {
          type: 'error',
          backgroundColor: '#dc3545',
          icon: false
        }
      ]
    });
  }

  // Ensure the modal properly initializes the star rating and character count
  $('#seeReviewsModal').on('shown.bs.modal', function () {
    // Initialize the star rating
    if ($(".star-rating").length) {
      $(".star-rating").css({
        "display": "flex",
        "flex-direction": "row-reverse",
        "justify-content": "center"
      });
      
      $(".star-rating input").css("display", "none");
    }
    
    // Initialize character counter if it exists
    if ($("#written-review").length && $(".character-counter").length) {
      const text_max = 5000;
      
      // Set initial counter value
      let text_length = $("#written-review").val().length;
      $(".character-counter").text(text_length + " / " + text_max);
      
      // Ensure the input event is properly bound for live updating
      $("#written-review").off("input").on("input", function() {
        text_length = $(this).val().length;
        $(".character-counter").text(text_length + " / " + text_max);
      });
    }
    
    // Set rooms-page class for consistent styling
    $('body').addClass('rooms-page');
  });

  // Ensure jQuery Confirm is loaded for review submission
  $(document).ready(function() {
    // Check if jQuery Confirm is already loaded
    if (typeof $.confirm !== 'function') {
      console.log("Loading jQuery Confirm for the modal context");
      
      // Load required CSS
      if (!$('link[href*="jquery-confirm"]').length) {
        $('head').append('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.css">');
      }
      
      // Load required JS
      $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js")
        .done(function() {
          console.log("jQuery Confirm loaded successfully");
        })
        .fail(function() {
          console.error("Failed to load jQuery Confirm");
        });
    }
    
    // Also ensure Notyf is available for notifications
    if (typeof Notyf === 'undefined') {
      console.log("Loading Notyf for the modal context");
      
      // Load Notyf CSS
      if (!$('link[href*="notyf"]').length) {
        $('head').append('<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">');
      }
      
      // Load Notyf JS
      $.getScript("https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js")
        .done(function() {
          console.log("Notyf loaded successfully");
          window.Notyf = Notyf; // Ensure global availability
        })
        .fail(function() {
          console.error("Failed to load Notyf");
        });
    }
    
    // Initialize modal handlers
    $('#seeReviewsModal').on('shown.bs.modal', function() {
      console.log("Modal shown - ensuring character counter is initialized");
      
      // Make sure the character counter is initialized when the modal contents are loaded
      if (typeof initializeCharCounter === 'function') {
        setTimeout(initializeCharCounter, 300);
      }
      
      // Make sure the star ratings are clickable
      setTimeout(function() {
        $(".star-rating label").css("cursor", "pointer");
      }, 300);
    });
  });
</script>
